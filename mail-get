#!/usr/bin/env bash
#
# Get mail and give notification + sound.

mpop -a >> "${XDG_VAR_HOME}/log/mpop.log" 2>&1;

mapfile -t reply < <(
        imapfilter \
                -c "${HOME}/.imapfilter/localhost.lua" \
                -l "${XDG_VAR_HOME}/log/imapfilter.log";
)

read -r _ _ _ c0 <<< "${reply[0]}"
read -r _ _ _ c1 <<< "${reply[1]}"

if
        (( c0 + c1 > 0 ))
then
        aplay "${XDG_DATA_HOME}/sounds/mac-sound-pack-new-mail.wav" \
                1>/dev/null 2>&1;
        if
                [[ -n $DISPLAY ]]
        then
                notify-send -u low -h int:value:42 "${reply[0]}\n${reply[1]}"
        else
                printf '%s\n' "${reply[0]}" "${reply[1]}" 2>&1;
        fi
fi

# vim: set ts=8 sw=8 tw=0 et :
