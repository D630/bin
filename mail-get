#!/usr/bin/env bash
#
# Get mail and give notification + sound.

exec 9<"$0";
flock -n 9 || {
    printf 'sorry, I am already running\n' 1>&2;
    exit 1;
};

mail-retrieve ||
    exit $?;

mapfile -t reply < <(imapfilter-localhost-unseen);

((
    ${reply[0]##*:}
    + ${reply[1]##*:}
    + ${reply[2]##*:}
    + ${reply[3]##*:} > 0
)) ||
    exit 1;

loggi 6 .email.arrived \
 "${reply[0]:-?}\n${reply[1]:-?}\n${reply[2]:-?}\n${reply[3]:-?}";

# vim: set ts=4 sw=4 tw=0 et :
