#!/usr/bin/env bash
#
# Get mail and give notification + sound.

mpop -a >> "${XDG_VAR_HOME}/log/mpop.log" 2>&1;

mapfile -t reply < <(
        imapfilter \
                -c "${HOME}/.imapfilter/localhost.lua" \
                -l "${XDG_VAR_HOME}/log/imapfilter.log";
)

(( ${reply[0]//[!0-9]/} + ${reply[1]//[!0-9]/} > 0 )) || exit 1;

if
        [[ -n $DISPLAY ]]
then
        notify-send --category=email.arrived -u normal \
                "email.arrived:" \
                "${reply[0]:-?}\n${reply[1]:-?}";
else
        sound _ "email.arrived:"
        printf 'Mail arrived:\n%s\n' "${reply[0]:-?}" "${reply[1]:-?}" 2>&1;
fi

# vim: set ts=8 sw=8 tw=0 et :
